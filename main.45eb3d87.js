parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"ZCfc":[function(require,module,exports) {
"use strict";var e,t,n=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r};function i(e,t){var n=e.point2.x-e.point1.x,r=e.point2.y-e.point1.y,i=t.point2.x-t.point1.x,o=t.point2.y-t.point1.y,a=(-r*(e.point1.x-t.point1.x)+n*(e.point1.y-t.point1.y))/(-i*r+n*o),s=(i*(e.point1.y-t.point1.y)-o*(e.point1.x-t.point1.x))/(-i*r+n*o);return a>=0&&a<=1&&s>=0&&s<=1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.DrawingCanvas=exports.Controller=exports.CreationForm=exports.Hierarchy=exports.Canvas=exports.Triangle=exports.Circle=exports.Rectangle=exports.Param=exports.Transform=exports.Point=void 0,function(e){e[e.Canvas=0]="Canvas",e[e.Rectangle=1]="Rectangle",e[e.Circle=2]="Circle",e[e.Triangle=3]="Triangle"}(t||(t={}));var o=((e={})[t.Canvas]="Canvas",e[t.Rectangle]="Rectangle",e[t.Circle]="Circle",e[t.Triangle]="Triangle",e),a=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.rotateAround=function(e,t){var n=Math.PI/180*t,r=Math.cos(n),i=Math.sin(n),o=r*(this.x-e.x)+i*(this.y-e.y)+e.x,a=r*(this.y-e.y)-i*(this.x-e.x)+e.y;this.x=o,this.y=a},e.zero=new e(0,0),e.unit=new e(1,1),e}();exports.Point=a;var s=function(){function e(e,t,n){this.position=e,this.rotation=t,this.scale=n}return e.prototype.add=function(t){return new e(new a(this.position.x+t.position.x,this.position.y+t.position.y),this.rotation+t.rotation,new a(this.scale.x*t.scale.x,this.scale.y*t.scale.y))},e.default=new e(a.zero,0,a.unit),e.zero=new e(a.zero,0,a.zero),e}();exports.Transform=s;var l=function(){return function(){}}();exports.Param=l;var d=function(){function e(e,t){this.transform=e,this.children=[],this.selected=!1,this.parent=t}return Object.defineProperty(e.prototype,"type",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.addChild=function(e){this.children.push(e)},e.prototype.removeChild=function(e){this.children=this.children.filter(function(t){return t!==e})},e}(),c=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.drawPoints=[],r}return n(t,e),t.prototype.isStable=function(){for(var e=this,t=0,n=this.drawPoints;t<n.length;t++){var r=n[t];if(!this.parent.isPointInside(r))return!1}for(var i=0,o=this.parent.children.filter(function(t){return t!==e});i<o.length;i++){for(var a=o[i],s=0,l=this.drawPoints;s<l.length;s++){r=l[s];if(a.isPointInside(r))return!1}for(var d=0,c=a.getPoints();d<c.length;d++){r=c[d];if(this.isPointInside(r))return!1}if(this.isIntersecting(a))return!1}return!0},t.prototype.getCenter=function(){return this.drawPoints.reduce(function(e,t,n,r){return new a(e.x+t.x/r.length,e.y+t.y/r.length)},new a(0,0))},t.prototype.draw=function(e,t,n){var r=this;void 0===t&&(t=null),void 0===n&&(n=null),null===t&&(t=new a(0,0)),null===n&&(n=new s(a.zero,0,a.unit));var i=new s(new a(t.x+this.transform.position.x,t.y+this.transform.position.y),n.rotation+this.transform.rotation,new a(n.scale.x*this.transform.scale.x,n.scale.y*this.transform.scale.y));this.drawPoints=this.points.map(function(e){var o=new a(t.x+r.transform.position.x+e.x*i.scale.x,t.y+r.transform.position.y+e.y*i.scale.y);return o.rotateAround(new a(i.position.x,i.position.y),r.transform.rotation),o.rotateAround(t,n.rotation),o});var o=e.strokeStyle;this.isStable()?e.strokeStyle="black":e.strokeStyle="red",e.beginPath(),e.moveTo(this.drawPoints[0].x,this.drawPoints[0].y);for(var l=1;l<this.drawPoints.length;l++)e.lineTo(this.drawPoints[l].x,this.drawPoints[l].y);e.lineTo(this.drawPoints[0].x,this.drawPoints[0].y),e.stroke(),this.children.forEach(function(t){return t.draw(e,r.getCenter(),i)}),e.strokeStyle=o},t.prototype.getPoints=function(){return this.drawPoints},t.prototype.isPointInside=function(e){for(var t=e.x,n=e.y,r=!1,i=0,o=this.drawPoints.length-1;i<this.drawPoints.length;o=i++){var a=this.drawPoints[i].x,s=this.drawPoints[i].y,l=this.drawPoints[o].x,d=this.drawPoints[o].y;s>n!=d>n&&t<(l-a)*(n-s)/(d-s)+a&&(r=!r)}return r},t.prototype.isIntersecting=function(e){if(!(e instanceof t))throw"Not implemented";for(var n=e,r=[],o=0;o<this.drawPoints.length;o++)r.push({point1:this.drawPoints[o],point2:this.drawPoints[(o+1)%this.drawPoints.length]});var a=[];for(o=0;o<n.drawPoints.length;o++)a.push({point1:n.drawPoints[o],point2:n.drawPoints[(o+1)%n.drawPoints.length]});for(var s=0,l=r;s<l.length;s++)for(var d=l[s],c=0,h=a;c<h.length;c++){if(i(d,h[c]))return!0}return!1},t}(d),h=function(e){function r(t,n,r,i){var o=e.call(this,r,i)||this;o.points=[];var s=t/2,l=n/2;return o.points.push(new a(-s,+l)),o.points.push(new a(+s,+l)),o.points.push(new a(+s,-l)),o.points.push(new a(-s,-l)),o}return n(r,e),Object.defineProperty(r.prototype,"type",{get:function(){return t.Rectangle},enumerable:!1,configurable:!0}),r.prototype.getParams=function(){return[{id:"width",name:"Width"},{id:"height",name:"Height"}]},r.buildFromParams=function(e,t,n){return new r(n.width,n.height,t,e)},r}(c);exports.Rectangle=h;var p=function(e){function r(t,n,r){void 0===r&&(r=null);var i=e.call(this,n,r)||this;i.pointsAmount=100,i.points=[];for(var o=2*Math.PI/i.pointsAmount,s=0,l=0;l<i.pointsAmount;l++)i.points.push(new a(Math.cos(s)*t,Math.sin(s)*t)),s+=o;return i}return n(r,e),Object.defineProperty(r.prototype,"type",{get:function(){return t.Circle},enumerable:!1,configurable:!0}),r.prototype.getParams=function(){return[{id:"radius",name:"Radius"}]},r.buildFromParams=function(e,t,n){return new r(n.radius,t,e)},r}(c);exports.Circle=p;var u=function(e){function r(t,n,r,i,o){void 0===o&&(o=null);var a=e.call(this,i,o)||this;return a.points=[t,n,r],a}return n(r,e),Object.defineProperty(r.prototype,"type",{get:function(){return t.Triangle},enumerable:!1,configurable:!0}),r.prototype.getParams=function(){return[{id:"point1_x",name:"X1"},{id:"point1_y",name:"Y1"},{id:"point2_x",name:"X2"},{id:"point2_y",name:"Y2"},{id:"point3_x",name:"X3"},{id:"point3_y",name:"Y3"}]},r.buildFromParams=function(e,t,n){var i=n.point1_x,o=n.point1_y,s=n.point2_x,l=n.point2_y,d=n.point3_x,c=n.point3_y;return new r(new a(i,o),new a(s,l),new a(d,c),t,e)},r}(c);exports.Triangle=u;var m=function(e){function r(t,n,r){return e.call(this,t,n,r,null)||this}return n(r,e),Object.defineProperty(r.prototype,"type",{get:function(){return t.Canvas},enumerable:!1,configurable:!0}),r.prototype.isStable=function(){return!0},r}(h);exports.Canvas=m;var f=function(){function e(e){this.element=document.createElement("ul"),this.element.classList.add("tree"),this.selectNode=e}return e.prototype.getElement=function(){return this.element},e.prototype.makeHierarchy=function(e){var t=this,n=document.createElement("li"),r=document.createElement("span");r.innerText=o[e.type],e.selected&&r.classList.add("active"),r.addEventListener("click",function(){t.selectNode(e)}),n.appendChild(r);for(var i=document.createElement("ul"),a=0,s=e.children;a<s.length;a++){var l=s[a];i.appendChild(this.makeHierarchy(l))}return n.appendChild(i),n},e.prototype.render=function(e){this.element.innerHTML="",this.element.appendChild(this.makeHierarchy(e))},e}();exports.Hierarchy=f;var v=function(){function e(e,t,n,r,i,o){this.shapes=e,this.createtNode=t,this.previewNode=n,this.cancel=r,this.translate=i,this.previewTranslate=o,this.element=document.createElement("div"),this.render()}return e.prototype.getElement=function(){return this.element},e.prototype.setShape=function(e){this.shape=e,this.render()},e.prototype.render=function(){var e=this;if(this.element.innerHTML="",this.shape||this.isEdit){var t=document.createElement("button");t.classList.add("btn","btn-danger","mb-1"),t.innerText="Cancel",t.addEventListener("click",function(t){e.isEdit?(e.previewTranslate(s.zero),e.isEdit=!1,e.cancel(),e.render()):(e.shape=null,e.cancel(),e.render())}),this.element.appendChild(t);var n=[];if(!this.isEdit){var i=document.createElement("div");i.classList.add("input-group","d-flex","mb-1");for(var l=0,d=this.shape.prototype.getParams();l<d.length;l++){var c=d[l],h=document.createElement("input");h.classList.add("form-control"),h.placeholder=c.name,h.name=c.id,n.push(h),i.appendChild(h)}this.element.appendChild(i)}var p=document.createElement("div");p.classList.add("input-group","d-flex");var u=document.createElement("label");u.classList.add("d-flex","col-form-label"),u.textContent="X:";var m=document.createElement("input");m.classList.add("form-control","w-auto","mt-n2","mr-2","ml-1"),m.value="0",u.appendChild(m),p.appendChild(u);var f=document.createElement("label");f.classList.add("d-flex","col-form-label"),f.textContent="Y:";var v=document.createElement("input");v.classList.add("form-control","w-auto","mt-n2","mr-2","ml-1"),v.value="0",f.appendChild(v),p.appendChild(f);var y=document.createElement("label");y.classList.add("d-flex","col-form-label"),y.textContent="Rotation(deg):";var w=document.createElement("input");w.classList.add("form-control","w-auto","mt-n2","mr-2","ml-1"),w.value="0",y.appendChild(w),p.appendChild(y);var g=document.createElement("label");g.classList.add("d-flex","col-form-label"),g.textContent="X Scale:";var x=document.createElement("input");x.classList.add("form-control","w-auto","mt-n2","mr-2","ml-1"),x.value="1",g.appendChild(x),p.appendChild(g);var C=document.createElement("label");C.classList.add("d-flex","col-form-label"),C.textContent="Y Scale:";var P=document.createElement("input");P.classList.add("form-control","w-auto","mt-n2","mr-2","ml-1"),P.value="1",C.appendChild(P),p.appendChild(C),this.element.appendChild(p),r(n,[m,v,w,x,P]).forEach(function(t){t.type="number",t.addEventListener("change",function(){var t=[],r=new s(new a(parseInt(m.value),parseInt(v.value)),parseInt(w.value),new a(parseInt(x.value),parseInt(P.value)));if(e.isEdit)e.previewTranslate(r);else{for(var i=0,o=n;i<o.length;i++){var l=o[i];t[l.name]=l.value}e.previewNode(e.shape,r,t)}})});var E=document.createElement("btn");E.classList.add("btn","btn-primary"),E.innerText="Save",E.addEventListener("click",function(){for(var t=[],r=new s(new a(parseInt(m.value),parseInt(v.value)),parseInt(w.value),new a(parseInt(x.value),parseInt(P.value))),i=0,o=n;i<o.length;i++){var l=o[i];t[l.name]=l.value}e.isEdit?e.translate(r)&&(e.isEdit=!1,e.render()):e.createtNode(e.shape,r,t)&&(e.shape=null,e.render())}),this.element.appendChild(E);var b=new Event("change");m.dispatchEvent(b)}else{(N=document.createElement("label")).classList.add("mr-2"),N.innerText="Edit:",this.element.appendChild(N);var N,L=document.createElement("div");L.classList.add("btn","btn-primary","mr-2"),L.innerText="Edit",L.addEventListener("click",function(){e.isEdit=!0,e.render()}),this.element.appendChild(L),(N=document.createElement("label")).classList.add("mr-2"),N.innerText="Create:",this.element.appendChild(N);var T=document.createElement("div");T.classList.add("btn-group");for(var _=function(t){I.isEdit=!1;var n=document.createElement("button");n.classList.add("btn","btn-success"),n.innerText=o[t.prototype.type],n.addEventListener("click",function(n){e.setShape(t)}),T.appendChild(n)},I=this,S=0,k=this.shapes;S<k.length;S++){_(k[S])}this.element.appendChild(T)}},e}();exports.CreationForm=v;var y=function(){function e(e,t){var n=this;void 0===e&&(e=640),void 0===t&&(t=480),this.element=document.createElement("div"),this.element.classList.add("row","mt-2"),this.drawingCanvas=new g(e,t,function(e){return n.selectNodeAtPoint(e)});var r=document.createElement("div");r.classList.add("col-12","col-md-8"),r.appendChild(this.drawingCanvas.getElement()),this.element.appendChild(r),this.hierarchy=new f(function(e){return n.selectNode(e)});var i=document.createElement("div");i.classList.add("col-12","col-md-4"),i.appendChild(this.hierarchy.getElement()),this.element.appendChild(i),this.creationForm=new v([h,u,p],function(e,t,r){return n.createNode(e,t,r)},function(e,t,r){return n.preview(e,t,r)},function(){return n.removePreviewNode()},function(e){return n.translate(e)},function(e){return n.previewTranslate(e)});var o=document.createElement("div");o.classList.add("col-12","col-md-6","mt-2"),o.appendChild(this.creationForm.getElement()),this.element.appendChild(o),this.canvas=new m(e,t,new s(new a(e/2,t/2),0,a.unit)),this.selectedNode=null,this.previewNode=null,this.isInEdit=!1,this.selectNode(this.canvas),this.render()}return e.prototype.selectNode=function(e){null!==this.previewNode||this.isInEdit?alert("Please finish editing first!"):(null!==this.selectedNode&&(this.selectedNode.selected=!1),e.selected=!0,this.selectedNode=e,this.render())},e.prototype.selectNodeAtPoint=function(e){console.log("hi");for(var t=this.canvas,n=!0;n;){n=!1;for(var r=0,i=t.children;r<i.length;r++){var o=i[r];if(o.isPointInside(e)){t=o,n=!0;break}}}this.selectNode(t)},e.prototype.removePreviewNode=function(){this.isInEdit=!1,null!==this.previewNode&&(this.previewNode.parent.removeChild(this.previewNode),this.previewNode=null),this.render()},e.prototype.preview=function(e,t,n){if(this.removePreviewNode(),null===this.selectedNode)return alert("Please select node you want add new child to"),!1;var r=e.buildFromParams(this.selectedNode,t,n);return this.selectedNode.addChild(r),this.previewNode=r,this.render(),!0},e.prototype.createNode=function(e,t,n){if(!this.previewNode.isStable())return alert("New shape can't be placed here"),!1;if(this.removePreviewNode(),null===this.selectedNode)return alert("Please select node you want add new child to"),!1;var r=e.buildFromParams(this.selectedNode,t,n);return this.selectedNode.addChild(r),this.render(),!0},e.prototype.translate=function(e){if(this.selectedNode instanceof m)return!1;var t=this.selectedNode.transform;return this.selectedNode.transform=this.selectedNode.transform.add(e),this.render(),this.selectedNode.isStable()?(this.isInEdit=!1,!0):(this.selectedNode.transform=t,alert("Shape can't be placed here"),!1)},e.prototype.previewTranslate=function(e){if(this.isInEdit=!0,!(this.selectedNode instanceof m)){var t=this.selectedNode.transform;this.selectedNode.transform=this.selectedNode.transform.add(e),this.render(),this.selectedNode.transform=t}},e.prototype.getElement=function(){return this.element},e.prototype.render=function(){this.drawingCanvas.render(this.canvas),this.hierarchy.render(this.canvas)},e}();function w(e,t){var n=e.getBoundingClientRect(),r=t.clientX-n.left,i=t.clientY-n.top;return new a(r,i)}exports.Controller=y;var g=function(){function e(e,t,n){var r=this;this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.canvasCtx=this.canvas.getContext("2d"),this.canvas.setAttribute("width",e.toString()),this.canvas.setAttribute("height",t.toString()),this.canvas.classList.add("d-block","m-auto","align-self-center"),this.canvas.addEventListener("mousedown",function(e){n(w(r.canvas,e))})}return e.prototype.getElement=function(){return this.canvas},e.prototype.getCtx=function(){return this.canvasCtx},e.prototype.clear=function(){this.canvasCtx.clearRect(0,0,this.width,this.height)},e.prototype.render=function(e){this.clear(),e.draw(this.canvasCtx,a.zero,s.default)},e}();exports.DrawingCanvas=g;var x=document.getElementById("main"),C=new y;x.appendChild(C.getElement());
},{}]},{},["ZCfc"], null)
//# sourceMappingURL=main.45eb3d87.js.map